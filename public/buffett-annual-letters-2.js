/**
 * Berkshire Hathaway Annual Letters - Key Lessons and Insights (Part 2)
 * Source: https://www.berkshirehathaway.com/letters/letters.html
 * 
 * This database contains the key investing principles, business insights,
 * and wisdom extracted from Warren Buffett's annual letters to Berkshire
 * shareholders from 2013-2017.
 */

const buffettAnnualLetters2 = {
  // Previous 5 years (2013-2017)
  previousLetters: {
    // 2017 Annual Letter
    "2017": {
      year: 2017,
      keyInsights: [
        {
          topic: "Focus on Change in Book Value",
          insight: "Berkshire's gain in net worth during 2017 was $65.3 billion. But only $36 billion came from our business operations. The remaining $29 billion was delivered by the Tax Cuts and Jobs Act of 2017. The new law made our huge unrealized capital gains much more valuable by materially reducing the tax rate that will be applied to their future realization.",
          context: "Explaining how tax law changes affected Berkshire's book value",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Avoiding Borrowed Money",
          insight: "Our aversion to leverage has dampened our returns over the years. But Charlie and I sleep well. Both of us believe it is insane to risk what you have and need in order to obtain what you don't need. We held this view 50 years ago when we each ran an investment partnership, funded by a few friends and relatives who trusted us. We also hold it today after a million or so 'partners' have joined us at Berkshire.",
          context: "Explaining Berkshire's conservative approach to debt",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Market Crashes Are Inevitable",
          insight: "In the next 53 years, our shares (and others) will experience declines resembling those in the table. No one can tell you when these traumas will occur – not me, not Charlie, not economists, not the media. During such scary periods, you should never forget two things: First, widespread fear is your friend as an investor, because it serves up bargain purchases. Second, personal fear is your enemy.",
          context: "Discussing market downturns and how investors should respond",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Investment 'Advice'",
          insight: "I want to quickly acknowledge that in any upcoming day, week or even year, stocks will be riskier – far riskier – than short-term U.S. bonds. As an investor's investment horizon lengthens, however, a diversified portfolio of U.S. equities becomes progressively less risky than bonds, assuming that the stocks are purchased at a sensible multiple of earnings relative to then-prevailing interest rates.",
          context: "Discussing the tradeoffs between stocks and bonds for different time horizons",
          relevantCompanies: ["BRK.A", "BRK.B"]
        }
      ],
      notableInvestments: ["AAPL", "BAC", "KHC"],
      economicContext: "Tax cuts, economic growth, and stock market strength"
    },
    
    // 2016 Annual Letter
    "2016": {
      year: 2016,
      keyInsights: [
        {
          topic: "America's Economic Dynamism",
          insight: "One word sums up our country's achievements: miraculous. From a standing start 240 years ago – a span of time less than triple my days on earth – Americans have combined human ingenuity, a market system, a tide of talented and ambitious immigrants, and the rule of law to deliver abundance beyond any dreams of our forefathers.",
          context: "Emphasizing a long-term optimistic view on American business",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Value of Share Repurchases",
          insight: "Many companies now repurchase shares for reasons that may be harmful to long-term owners. The first is stock-based compensation. Today, repurchases are the easiest way to dispose of these shares. Continuing shareholders are hurt unless shares are purchased below intrinsic value.",
          context: "Explaining when share repurchases create or destroy value",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Investment Fees",
          insight: "When trillions of dollars are managed by Wall Streeters charging high fees, it will usually be the managers who reap outsized profits, not the clients. Both large and small investors should stick with low-cost index funds.",
          context: "Warning about the impact of high investment fees on returns",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Insurance 'Float'",
          insight: "Property/casualty insurance is the main arena in which Berkshire operates, and it's also an industry in which we possess a significant competitive advantage. We have now operated at an underwriting profit for 14 consecutive years. That record is no accident: Disciplined risk evaluation is the daily focus of our insurance managers. The goal of every insurer is to make an underwriting profit, but it's not easy to achieve.",
          context: "Explaining Berkshire's insurance business model and competitive advantage",
          relevantCompanies: ["BRK.A", "BRK.B", "GEICO"]
        }
      ],
      notableInvestments: ["AAPL", "KO", "AXP"],
      economicContext: "Presidential election, continued economic recovery"
    },
    
    // 2015 Annual Letter
    "2015": {
      year: 2015,
      keyInsights: [
        {
          topic: "Productivity and Prosperity",
          insight: "For 240 years it's been a terrible mistake to bet against America, and now is no time to start. America's golden goose of commerce and innovation will continue to lay more and larger eggs. America's social security promises will be honored and perhaps made more generous. And, yes, America's kids will live far better than their parents did.",
          context: "Addressing concerns about America's future economic prospects",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Business vs. Investment Performance",
          insight: "A number of Berkshire shareholders – including some of my good friends – would like Berkshire to pay a meaningful dividend. Charlie and I understand their reasoning. So our shareholder-partners shouldn't worry that our share-buying will ever cease because we feel that Berkshire's intrinsic value is not properly reflected in its market value. If our share price is at or below intrinsic value, large repurchases will benefit both those shareholders leaving the company and those who stay.",
          context: "Discussing Berkshire's approach to dividends and share repurchases",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "BNSF Railway",
          insight: "BNSF is the largest of our 'Powerhouse Five' non-insurance businesses, which also include Berkshire Hathaway Energy, Marmon, Lubrizol and IMC. Combined, these companies – our 'big five' – earned $13.1 billion in 2015, an increase of $650 million over 2014.",
          context: "Highlighting the importance of BNSF to Berkshire's non-insurance earnings",
          relevantCompanies: ["BRK.A", "BRK.B", "BNSF"]
        },
        {
          topic: "Conglomerates",
          insight: "Berkshire is now a sprawling conglomerate, constantly trying to sprawl further. Conglomerates generally have a terrible reputation, and they richly deserve it. Many have been assembled by managers who buy businesses only to inflate their share count. Some actually boast about their skill as deal-makers. That strategy is certain to produce sub-par returns. Why? The reason is that the manager is then left with the job of continuously purchasing new businesses at advantageous prices.",
          context: "Addressing criticisms of the conglomerate business model",
          relevantCompanies: ["BRK.A", "BRK.B"]
        }
      ],
      notableInvestments: ["KHC", "KO", "AXP"],
      economicContext: "Global economic concerns, China slowdown, oil price collapse"
    },
    
    // 2014 Annual Letter - 50th Anniversary Special
    "2014": {
      year: 2014,
      keyInsights: [
        {
          topic: "The Next 50 Years",
          insight: "Berkshire's shares will provide a safe and rewarding investment only if the Company itself delivers one. That will depend on Berkshire's CEOs and Board being prepared to continuously and rationally allocate capital, and to improve the return on the capital already deployed. I believe that the chance of permanent capital loss for patient Berkshire shareholders is as low as can be found among single-company investments.",
          context: "Looking ahead to Berkshire's future in a special 50th anniversary letter",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Capital Allocation",
          insight: "I've made plenty of mistakes since then, but they've been errors of omission, not commission. My job is to identify truly outstanding businesses with first-class management at sensible prices and then wait as they compound value over time, rather than moving from flower to flower.",
          context: "Reflecting on investment decisions over 50 years",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Succession Planning",
          insight: "Both the board and I believe we now have the right person to succeed me as CEO – a successor ready to assume the job the day after I die or step down. In certain important respects, this person will do a better job than I am doing.",
          context: "Addressing concerns about Berkshire's future leadership",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "The Lessons of 50 Years",
          insight: "My successor will need one other particular strength: the ability to fight off the ABCs of business decay, which are arrogance, bureaucracy and complacency. When these corporate cancers metastasize, even the strongest of companies can falter.",
          context: "Reflecting on the challenges of maintaining a successful corporate culture",
          relevantCompanies: ["BRK.A", "BRK.B"]
        }
      ],
      notableInvestments: ["IBM", "KO", "AXP", "WFC"],
      economicContext: "Strong economic growth in U.S., global economic concerns"
    },
    
    // 2013 Annual Letter
    "2013": {
      year: 2013,
      keyInsights: [
        {
          topic: "Intrinsic Value vs. Book Value",
          insight: "As I've long told you, Berkshire's intrinsic value far exceeds its book value. Moreover, the difference has widened considerably in recent years. That's why our 2012 decision to authorize repurchases at 120% of book value made sense. Purchases at that level benefit continuing shareholders because the market premium over book value reflects only a portion of Berkshire's intrinsic value.",
          context: "Explaining the growing gap between Berkshire's intrinsic value and book value",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "The Power of America",
          insight: "Indeed, who has ever benefited during the past 237 years by betting against America? If you compare our country's present condition to that existing in 1776, you have to rub your eyes in wonder. And the dynamism embedded in our market economy will continue to work its magic. America's best days lie ahead.",
          context: "Expressing long-term optimism about America's future",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Mistakes of Commission",
          insight: "In the world of business, bad news often surfaces serially: You see a cockroach in your kitchen; as the days go by, you meet his relatives. Occasionally, I've been surprised by how CEOs of companies have concealed problems they knew existed, but I've never concealed anything from investors that I thought they should know.",
          context: "Discussing the importance of transparent corporate communication",
          relevantCompanies: ["BRK.A", "BRK.B"]
        },
        {
          topic: "Stock Valuation",
          insight: "Games are won by players who focus on the playing field – not by those whose eyes are glued to the scoreboard. If you can enjoy Saturdays and Sundays without looking at stock prices, give it a try on weekdays.",
          context: "Advising investors to focus on business fundamentals rather than stock prices",
          relevantCompanies: ["BRK.A", "BRK.B"]
        }
      ],
      notableInvestments: ["IBM", "WFC", "KO", "AXP"],
      economicContext: "Continued economic recovery, Federal Reserve tapering concerns"
    }
  },
  
  // Methods to retrieve relevant insights
  getInsightsByYear: function(year) {
    // Return all insights from a specific year
    if (this.previousLetters[year]) {
      return this.previousLetters[year].keyInsights;
    }
    return [];
  },
  
  getInsightsByTopic: function(topic) {
    // Find insights across all years related to a specific topic
    let results = [];
    
    for (const year in this.previousLetters) {
      const yearData = this.previousLetters[year];
      const matchingInsights = yearData.keyInsights.filter(insight => 
        insight.topic.toLowerCase().includes(topic.toLowerCase()) ||
        insight.insight.toLowerCase().includes(topic.toLowerCase())
      );
      
      if (matchingInsights.length > 0) {
        results = results.concat(matchingInsights.map(insight => {
          return {
            year: yearData.year,
            ...insight
          };
        }));
      }
    }
    
    return results;
  },
  
  getInsightsByCompany: function(ticker) {
    // Find insights that mention a specific company
    let results = [];
    
    for (const year in this.previousLetters) {
      const yearData = this.previousLetters[year];
      
      // Check notable investments
      if (yearData.notableInvestments && yearData.notableInvestments.includes(ticker)) {
        const relevantInsights = yearData.keyInsights.filter(insight => 
          insight.relevantCompanies && insight.relevantCompanies.includes(ticker)
        );
        
        if (relevantInsights.length > 0) {
          results = results.concat(relevantInsights.map(insight => {
            return {
              year: yearData.year,
              ...insight
            };
          }));
        }
      }
    }
    
    return results;
  },
  
  getRandomInsight: function() {
    // Get a random insight from any year
    const years = Object.keys(this.previousLetters);
    const randomYear = years[Math.floor(Math.random() * years.length)];
    const insights = this.previousLetters[randomYear].keyInsights;
    return {
      year: this.previousLetters[randomYear].year,
      ...insights[Math.floor(Math.random() * insights.length)]
    };
  }
};

// Make available globally
window.buffettAnnualLetters2 = buffettAnnualLetters2;
